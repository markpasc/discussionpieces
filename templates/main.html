{% extends "base.html" %}

{% block title %}hi{% endblock %}
{% block content_header %}hi{% endblock %}
{% block content %}

    <div id="sky"></div>
    <div id="ground"></div>
    
    <div id="cloud">
        <h1 id="cloud-title"></h1>
        <div>
            <img width="32" height="32" src="/assets/1.gif" id="cloud-icon">
            <span id="cloud-desc"></span>
        </div>
    </div>
    
    <script type="text/javascript">
    function clickerFor (item) {
        return function (e) {
            //alert('omg hi from ' + item.key);
            // Load piece's data into display bubble.
            $('#cloud-title').text(item.name);
            $('#cloud-desc').text(item.desc);
            $('#cloud-icon').attr('src', '/assets/icons/' + item.icon);
            $('#cloud').css('left', item.x + 'px');
            $('#cloud').css('top', (item.y - 140) + 'px')
            $('#cloud').show('clip', {}, 200);
        };
    }
    
    $(document).ready(function () {
        $.getJSON("/stuff", function (data) {
            $.each(data, function (i, item) {
                var div = $("<div/>")
                    .attr("class", "piece")
                    .attr("id", "piece-" + item.key)
                    .appendTo('#ground');
                var img = $("<img/>")
                    .attr("src", "/assets/icons/" + item.icon)
                    .appendTo(div);
                div.css('left', item.x);
                div.css('top',  item.y);
                div.draggable({
                    'containment': '#ground',
                    'stop': function (e) {
                        item.x = parseInt(div.css('left'));
                        item.y = parseInt(div.css('top'));
                        $.post("/stuff/" + item.key,
                            {'x': item.x, 'y': item.y}
                        );
                    }
                });
                div.click(clickerFor(item));
            });
        });
    });
    </script>

{% endblock %}
